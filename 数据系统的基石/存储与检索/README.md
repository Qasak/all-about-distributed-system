# 存储与检索

> Wer Ordnung hält, ist nur zu faul zum Suchen.
> (把东西放规矩，就不用找了)
> —German proverb  

两大类存储引擎：日志结构(log-structured)存储引擎和面向页面(page-oriented)的存储引擎(例如B树)

## 驱动数据库的数据结构

世界上最简单的数据库可以用两个Bash函数实现  

> grep (global search regular expression(RE) and print out the line,全局搜索正则表达式并打印行)

```bash
#!/bin/bash
db_set () {
	echo "$1,$2" >> database
} 

b_get () {
	grep "^$1," database | sed -e "s/^$1,//" | tail -n 1
}
```

底层的存储格式非常简单： 一个文本文件， 每行包含一条逗号分隔的键值对（ 忽略转义问题
的话， 大致与CSV文件类似） 。 每次对 db_set 的调用都会向文件末尾追加记录， 所以更新
键的时候旧版本的值不会被覆盖 —— 因而查找最新值的时候， 需要找到文件中键最后一次出
现的位置（ 因此 db_get 中使用了 tail -n 1 。 )  

db_set 函数对于极其简单的场景其实有非常好的性能， 因为在文件尾部追加写入通常是非常
高效的。 与 db_set 做的事情类似， 许多数据库在内部使用了日志（ log） ， 也就是一个 仅追
加（ append-only） 的数据文件。  

真正的数据库有更多的问题需要处理（ 如并发控制， 回收
磁盘空间以避免日志无限增长， 处理错误与部分写入的记录） ， 但基本原理是一样的。 日志
极其有用， 我们还将在本书的其它部分重复见到它好几次  

> 日志（ log） 这个词通常指应用日志： 即应用程序输出的描述发生事情的文本。 本书在更普遍的意义下使用日志这一词： *一个仅追加的记录序列*。 它可能压根就不是给人类看
> 的， 使用二进制格式， 并仅能由其他程序读取。  







