# GFS

## 概要

我们设计并实现了Google文件系统，一个可扩展的分布式文件系统，用于大型分布式数据密集型应用程序。它在运行于廉价的商品硬件上时提供了容错能力，并为大量客户机提供了高聚合性能。

虽然与以前的分布式文件系统有许多相同的目标，但我们的设计是由对当前和预期的应用程序工作负载和技术环境的观察所驱动的，这些都反映出与一些早期的文件系统假设的明显背离。这让我们重新审视传统的选择，探索完全不同的设计点。

该文件系统已经成功地满足了我们的存储需求。我们的研究和数据处理平台需要大量的数据存储和处理。迄今为止最大的集群在一千多台机器上的数千个磁盘上提供了数百TB的存储，并且可以由数百个客户机同时访问。

在这篇文章中，我们介绍了为支持分布式应用程序而设计的文件系统接口扩展，讨论了我们设计的许多方面，并报告了从微观基准测试和实际使用中进行的测量。

## 关键字

容错、可扩展性、数据存储、集群存储

## 1.简介

我们设计并实现了Google文件系统（GFS），以满足Google快速增长的数据处理需求。GFS与以前的分布式文件系统有许多相同的目标，比如性能、可扩展性、可靠性和可用性。然而，它的设计是由对我们当前和预期的应用程序工作负载和技术环境的关键观察结果驱动的，这些都反映出与一些早期的文件系统设计假设的明显偏离。我们重新审视了传统的选择，并探索了设计空间中完全不同的点。

首先，部件故障是正常现象，而不是例外。文件系统由数百甚至数千台存储机器组成，这些存储机器由廉价的商品部件构建而成，可供相当数量的客户机访问。组件的数量和质量实际上保证了某些组件在任何给定时间都无法正常工作，有些组件无法从当前的故障中恢复。我们已经看到了由应用程序错误、操作系统错误、人为错误以及磁盘、内存、连接器、网络和电源故障引起的问题。因此，必须将持续监控、错误检测、容错和自动恢复整合到系统中。

第二，按传统标准，文件非常庞大。多GB文件很常见。每个文件通常包含许多应用程序对象，如web文档。当我们经常使用由数十亿个对象组成的TB级的快速增长的数据集时，即使文件系统可以支持它，管理数十亿个大约KB大小的文件也很难管理。因此，必须重新考虑设计假设和参数，如I/O操作和块大小

第三，大多数文件都是通过附加(appending)新数据而不是覆盖现有数据来改变的。文件中的随机写入实际上是不存在的。一旦写入，文件就只能被读取，而且通常只能按顺序读取。各种数据共享这些特征。有些可能构成数据分析程序扫描的大型存储库。有些可能是运行应用程序连续生成的数据流。有些可能是存档数据。有些可能是在一台机器上产生并在另一台机器上进行处理的中间结果，无论是同时进行的还是以后的。考虑到这种对大文件的访问模式，附加成为性能优化和原子性保证的焦点，而在客户端缓存数据块则失去了吸引力。

第四，联合设计应用程序和文件系统API，通过增加灵活性，使整个系统受益。例如，我们放宽了GFS的一致性模型，以大大简化文件系统，而不会给应用程序带来沉重的负担。我们还引入了一个原子附加操作，这样多个客户机可以并发地追加到一个文件中，而不需要它们之间的额外同步。这些将在本文后面进行更详细的讨论。

目前部署了多个GFS集群用于不同的目的。最大的一个有1000多个存储节点，超过300 TB的磁盘存储，并且有数百个客户机连续地在不同的机器上进行大量访问。

## 2.设计概览

### 2.1 假设

在为我们的需求设计一个文件系统时，我们一直遵循既能带来挑战又能带来机遇的假设。我们之前提到了一些关键的观察结果，现在更详细地阐述了我们的假设。

+ 该系统由许多廉价的商品组件构成，这些组件通常会出现故障。它必须不断地自我监控，并在常规基础上检测、容忍和迅速从组件故障中恢复。
+ 系统存储少量大文件。我们希望有几百万个文件，每个文件的大小通常是100 MB或更大。多GB文件是常见的情况，应该进行有效的管理。必须支持小文件，但我们不需要为它们进行优化。
+ 工作负载主要由两种类型的读取组成：大型流式读取和小型随机读取。在大型流式读取中，单个操作通常读取数百KB，更常见的是1 MB或更多。来自同一客户机的连续操作通常会读取文件的一个连续区域。一个小的随机读取通常以任意偏移量读取几个KBs。注重性能的应用程序通常会对小的读取进行批处理和排序，以稳定地在文件中前进，而不是来回地进行。
+ 工作负载还有许多大的、顺序的写入操作，它们将数据附加到文件中。典型的操作尺寸与读取操作相似。一旦写入，文件很少再被修改。支持文件中任意位置的小的写操作，但不一定要高效。
+ 系统必须为同时附加到同一文件的多个客户端高效地实现定义良好的语义。我们的文件通常用作生产者-消费者队列或用于多种方式的合并。数百个生产者，每台机器运行一个，将并发地附加到一个文件中。原子性和最小的同步开销是必不可少的。稍后可能会读取该文件，或者使用者可能正在同时读取该文件。
+ 高持续带宽比低延迟更重要。我们的大多数目标应用程序都重视以高速率批量处理数据，而很少有应用程序对单个读或写有严格的响应时间要求。

### 2.2 接口

GFS提供了一个熟悉的文件系统接口，尽管它没有实现像POSIX这样的标准API。文件在目录中按层次组织，并由路径名标识。我们支持`create`、`delete`、`open`、`close`、`read`和`write`文件的常规操作。

此外，GFS有`snapshot`和`record append`操作。快照以低成本创建文件或目录树的副本。记录追加允许多个客户机同时向同一个文件追加数据，同时保证每个客户机的`append`的原子性。它对于实现多路合并结果和生产者-消费者队列非常有用，许多客户机可以同时追加到这些队列中，而无需额外锁定。我们发现这些类型的文件在构建大型分布式应用程序时非常有价值。快照和记录追加分别在第3.4节和第3.3节中进一步讨论

